function toggleRequestFields() {
  const selected = document.getElementById("wfm_request").value;
  const allTypes = [
    "Accommodation request/update", "Add additional hours", "Add/remove/change team meeting",
    "Add/remove/move training", "Add offline segment", "Advisor arrived late, remove absence",
    "CP skill update", "Employee status update (not for schedule changes)", "Is OT available?",
    "Move break/lunch because of meeting", "Schedule Update - CP3 use", "Schedule Error Adjustment",
    "Shift swap/offer", "Suggestions/Feedback", "Unpaid time off/vacation", "Testing"
  ];
  allTypes.forEach(type => {
    // build the id the same way original script expected
    const id = type.replace(/[\s\/(),?'-]/g, '') + "Fields";
    const section = document.getElementById(id);
    if (section) section.style.display = (type === selected) ? "block" : "none";
  });
}

/* Accommodation CP3 toggle */
function toggleAccommodationCP3(show) {
  const el = document.getElementById("cp3Upload");
  if (el) el.style.display = show ? "block" : "none";
}

/* Additional hours mode toggle */
function toggleAdditionalHoursMode(multi) {
  const single = document.getElementById("singleDayFields");
  const multiEl = document.getElementById("multiDayFields");
  if (single && multiEl) {
    single.style.display = multi ? "none" : "block";
    multiEl.style.display = multi ? "block" : "none";
  }
}

/* Return to work toggle for Employee Status */
function toggleReturnToWork() {
  const status = document.querySelector('input[name="status_update_type"]:checked');
  const returnField = document.getElementById("returnToWorkContainer");
  if (returnField) {
    returnField.style.display = (status && status.value === "Inactive") ? "block" : "none";
  }
}

/* CP skill language show/hide: keep original selects present but help user by focusing language */
function toggleCPSkillLanguage() {
  const lang = document.getElementById("cp_language").value;
  // Show/hide original blocks -- keep them in DOM so nothing is removed
  if (document.getElementById("orig_remove_en")) document.getElementById("orig_remove_en").style.display = (lang === "English") ? "block" : "none";
  if (document.getElementById("orig_add_en")) document.getElementById("orig_add_en").style.display = (lang === "English") ? "block" : "none";
  if (document.getElementById("orig_remove_fr")) document.getElementById("orig_remove_fr").style.display = (lang === "French") ? "block" : "none";
  if (document.getElementById("orig_add_fr")) document.getElementById("orig_add_fr").style.display = (lang === "French") ? "block" : "none";
  if (document.getElementById("orig_remove_bi")) document.getElementById("orig_remove_bi").style.display = (lang === "Bilingual") ? "block" : "none";
  if (document.getElementById("orig_add_bi")) document.getElementById("orig_add_bi").style.display = (lang === "Bilingual") ? "block" : "none";
}

/* Basic page-load: hide all CP skill original selects until language selected (but keep DOM) */
document.addEventListener("DOMContentLoaded", function() {
  // Initially hide all CP selects (they exist in DOM but hidden)
  if (document.getElementById("orig_remove_en")) document.getElementById("orig_remove_en").style.display = "none";
  if (document.getElementById("orig_add_en")) document.getElementById("orig_add_en").style.display = "none";
  if (document.getElementById("orig_remove_fr")) document.getElementById("orig_remove_fr").style.display = "none";
  if (document.getElementById("orig_add_fr")) document.getElementById("orig_add_fr").style.display = "none";
  if (document.getElementById("orig_remove_bi")) document.getElementById("orig_remove_bi").style.display = "none";
  if (document.getElementById("orig_add_bi")) document.getElementById("orig_add_bi").style.display = "none";

  // Also ensure Employee return-to-work container hidden initially
  const rtw = document.getElementById("returnToWorkContainer");
  if (rtw) rtw.style.display = "none";
});

function validateForm() {
  const req = document.getElementById("wfm_request").value;

  if (req === "Add/remove/change team meeting") {
    const a = document.querySelector('input[name="team_meeting_action"]:checked');
    const d = document.querySelector('input[name="team_meeting_date"]');
    const s = document.querySelector('input[name="team_meeting_start"]');
    const e = document.querySelector('input[name="team_meeting_end"]');
    const n = document.querySelector('textarea[name="team_meeting_notes"]');
    if (!a || !d.value || !s.value || !e.value) {
      alert("Please complete all required fields for the team meeting.");
      return false;
    }
    if (!n.value.trim()) {
      alert("Please provide notes or a reason for the team meeting request.");
      return false;
    }
  }

  if (req === "Add/remove/move training") {
    const a = document.querySelector('input[name="training_action"]:checked');
    const d = document.querySelector('input[name="training_date"]');
    const s = document.querySelector('input[name="training_start"]');
    const e = document.querySelector('input[name="training_end"]');
    const n = document.querySelector('textarea[name="training_notes"]');
    if (!a || !d.value || !s.value || !e.value) {
      alert("Please complete all required fields for the training request.");
      return false;
    }
    if (!n.value.trim()) {
      alert("Please provide notes or a reason for the training request.");
      return false;
    }
  }

  if (req === "Advisor arrived late, remove absence") {
    const s = document.querySelector('input[name="actual_start_time"]');
    const a = document.querySelector('input[name="actual_arrival_time"]');
    const n = document.querySelector('textarea[name="late_arrival_notes"]');
    if (!s.value || !a.value) {
      alert("Please fill both Actual Start and Arrival times.");
      return false;
    }
    if (!n.value.trim()) {
      alert("Please provide notes for the late arrival.");
      return false;
    }
  }

  if (req === "CP skill update") {
    // If CP skill update selected, require action + language + appropriate skill select + notes
    const action = document.getElementById("cp_action");
    const lang = document.getElementById("cp_language");
    const notes = document.querySelector('textarea[name="cp_skill_notes"]');

    if (!action || !lang || !action.value || !lang.value) {
      alert("Select CP skill action and language.");
      return false;
    }

    // Depending on language and action, ensure at least one of the corresponding original selects has value
    if (lang.value === "English") {
      // check add or remove english selects
      if (action.value === "Add") {
        const addEn = document.querySelector('select[name="skill_add_en"]');
        if (!addEn || !addEn.value) {
          alert("Select an English skill to add.");
          return false;
        }
      } else if (action.value === "Remove") {
        const remEn = document.querySelector('select[name="skill_remove_en"]');
        if (!remEn || !remEn.value) {
          alert("Select an English skill to remove.");
          return false;
        }
      }
    } else if (lang.value === "French") {
      if (action.value === "Add") {
        const addFr = document.querySelector('select[name="skill_add_fr"]');
        if (!addFr || !addFr.value) {
          alert("Select a French skill to add.");
          return false;
        }
      } else if (action.value === "Remove") {
        const remFr = document.querySelector('select[name="skill_remove_fr"]');
        if (!remFr || !remFr.value) {
          alert("Select a French skill to remove.");
          return false;
        }
      }
    } else if (lang.value === "Bilingual") {
      if (action.value === "Add") {
        const addBi = document.querySelector('select[name="skill_add_bi"]');
        if (!addBi || !addBi.value) {
          alert("Select a bilingual skill to add.");
          return false;
        }
      } else if (action.value === "Remove") {
        const remBi = document.querySelector('select[name="skill_remove_bi"]');
        if (!remBi || !remBi.value) {
          alert("Select a bilingual skill to remove.");
          return false;
        }
      }
    }

    if (!notes.value.trim()) {
      alert("Please provide notes for the CP skill update.");
      return false;
    }
  }

  if (req === "Employee status update (not for schedule changes)") {
    const emp = document.querySelector('input[name="status_update_employee"]');
    const type = document.querySelector('input[name="status_update_type"]:checked');
    const eff = document.querySelector('input[name="status_update_effective_date"]');
    const ret = document.querySelector('input[name="status_update_return_date"]');
    const notes = document.querySelector('textarea[name="status_update_notes"]');
    if (!emp.value || !type || !eff.value) {
      alert("Please complete all required fields for the status update.");
      return false;
    }
    if (type.value === "Inactive" && !ret.value) {
      alert("Please provide a Return to Work date for inactive status.");
      return false;
    }
    if (!notes.value.trim()) {
      alert("Please provide notes or a reason for the status update.");
      return false;
    }
  }

  return true;
}
</script>
</body>
</html>
