<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WFM Request Form</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css">
<style>
  .section { display: none; margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
  label { display: block; margin-top: 5px; }
  input, select, textarea { margin-bottom: 5px; width: 100%; max-width: 400px; }
</style>
</head>
<body>

<h1>ðŸ“‹ Workforce Management Request Form</h1>

<form id="wfmForm" onsubmit="return validateForm()" method="post" enctype="multipart/form-data">
  
  <!-- Request Type Dropdown -->
  <label for="wfm_request">Select Request Type:</label>
  <select id="wfm_request" name="wfm_request" onchange="toggleRequestFields()">
    <option value="">-- Select --</option>
    <option>Accommodation request/update</option>
    <option>Add additional hours</option>
    <option>Add/remove/change team meeting</option>
    <option>Add/remove/move training</option>
    <option>Add offline segment</option>
    <option>Advisor arrived late, remove absence</option>
    <option>CP skill update</option>
    <option>Employee status update (not for schedule changes)</option>
    <option>Is OT available?</option>
    <option>Move break/lunch because of meeting</option>
    <option>Schedule Update - CP3 use</option>
    <option>Schedule Error Adjustment</option>
    <option>Shift swap/offer</option>
    <option>Suggestions/Feedback</option>
    <option>Unpaid time off/vacation</option>
    <option>Testing</option>
  </select>

  <!-- 1. Accommodation request/update -->
  <div id="AccommodationrequestupdateFields" class="section">
    <label>Upload CP3 Form (if applicable):</label>
    <input type="file" id="cp3Upload" name="cp3_upload">
  </div>

  <!-- 2. Add additional hours -->
  <div id="AddadditionalhoursFields" class="section">
    <label>Single or Multiple Days?</label>
    <select onchange="toggleAdditionalHoursMode(this.value==='Multi')">
      <option value="Single">Single Day</option>
      <option value="Multi">Multiple Days</option>
    </select>

    <div id="singleDayFields">
      <label>Date:</label>
      <input type="text" name="single_date" class="datePicker">
      <label>Start Time:</label>
      <input type="time" name="single_start">
      <label>End Time:</label>
      <input type="time" name="single_end">
    </div>

    <div id="multiDayFields">
      <label>Start Date:</label>
      <input type="text" name="multi_start_date" class="datePicker">
      <label>End Date:</label>
      <input type="text" name="multi_end_date" class="datePicker">
      <label>Start Time:</label>
      <input type="time" name="multi_start">
      <label>End Time:</label>
      <input type="time" name="multi_end">
    </div>
  </div>

  <!-- 3. Add/remove/change team meeting -->
  <div id="AddremovechangeteammeetingFields" class="section">
    <label>Action:</label>
    <input type="radio" name="team_meeting_action" value="Add"> Add
    <input type="radio" name="team_meeting_action" value="Remove"> Remove
    <input type="radio" name="team_meeting_action" value="Change"> Change
    <label>Date:</label><input type="text" name="team_meeting_date" class="datePicker">
    <label>Start Time:</label><input type="time" name="team_meeting_start">
    <label>End Time:</label><input type="time" name="team_meeting_end">
    <label>Notes:</label><textarea name="team_meeting_notes"></textarea>
  </div>

  <!-- 4. Add/remove/move training -->
  <div id="AddremovemovetrainingFields" class="section">
    <label>Action:</label>
    <input type="radio" name="training_action" value="Add"> Add
    <input type="radio" name="training_action" value="Remove"> Remove
    <input type="radio" name="training_action" value="Move"> Move
    <label>Date:</label><input type="text" name="training_date" class="datePicker">
    <label>Start Time:</label><input type="time" name="training_start">
    <label>End Time:</label><input type="time" name="training_end">
    <label>Notes:</label><textarea name="training_notes"></textarea>
  </div>

  <!-- 5. Add offline segment -->
  <div id="AddofflinesegmentFields" class="section">
    <label>Details:</label><textarea name="offline_segment_details"></textarea>
  </div>

  <!-- 6. Advisor arrived late, remove absence -->
  <div id="AdvisorarrivedlateremoveabsenceFields" class="section">
    <label>Actual Start Time:</label><input type="time" name="actual_start_time">
    <label>Arrival Time:</label><input type="time" name="actual_arrival_time">
    <label>Notes:</label><textarea name="late_arrival_notes"></textarea>
  </div>

  <!-- 7. CP skill update -->
  <div id="CPskillupdateFields" class="section">
    <label>Action:</label>
    <select id="cp_action">
      <option value="">-- Select --</option>
      <option>Add</option>
      <option>Remove</option>
    </select>

    <label>Language:</label>
    <select id="cp_language" onchange="toggleCPSkillLanguage()">
      <option value="">-- Select --</option>
      <option>English</option>
      <option>French</option>
      <option>Bilingual</option>
    </select>

    <!-- Original select boxes for skills -->
    <div id="orig_add_en"><label>Add English Skill:</label><select name="skill_add_en"><option value="">--Select--</option></select></div>
    <div id="orig_remove_en"><label>Remove English Skill:</label><select name="skill_remove_en"><option value="">--Select--</option></select></div>
    <div id="orig_add_fr"><label>Add French Skill:</label><select name="skill_add_fr"><option value="">--Select--</option></select></div>
    <div id="orig_remove_fr"><label>Remove French Skill:</label><select name="skill_remove_fr"><option value="">--Select--</option></select></div>
    <div id="orig_add_bi"><label>Add Bilingual Skill:</label><select name="skill_add_bi"><option value="">--Select--</option></select></div>
    <div id="orig_remove_bi"><label>Remove Bilingual Skill:</label><select name="skill_remove_bi"><option value="">--Select--</option></select></div>

    <label>Notes:</label><textarea name="cp_skill_notes"></textarea>
  </div>

  <!-- 8. Employee status update -->
  <div id="EmployeestatusupdatenotforschedulechangesFields" class="section">
    <label>Employee:</label><input type="text" name="status_update_employee">
    <label>Status Type:</label>
    <input type="radio" name="status_update_type" value="Active" onclick="toggleReturnToWork()"> Active
    <input type="radio" name="status_update_type" value="Inactive" onclick="toggleReturnToWork()"> Inactive
    <div id="returnToWorkContainer">
      <label>Return to Work Date:</label><input type="text" name="status_update_return_date" class="datePicker">
    </div>
    <label>Effective Date:</label><input type="text" name="status_update_effective_date" class="datePicker">
    <label>Notes:</label><textarea name="status_update_notes"></textarea>
  </div>

  <!-- Submit Button -->
  <button type="submit">Submit Request</button>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js"></script>
<script>
  flatpickr(".datePicker", { dateFormat: "Y-m-d" });
</script>
<script>
/* Toggle the display of request sections based on selection */
function toggleRequestFields() {
  const selected = document.getElementById("wfm_request").value;
  const allTypes = [
    "Accommodation request/update", "Add additional hours", "Add/remove/change team meeting",
    "Add/remove/move training", "Add offline segment", "Advisor arrived late, remove absence",
    "CP skill update", "Employee status update (not for schedule changes)", "Is OT available?",
    "Move break/lunch because of meeting", "Schedule Update - CP3 use", "Schedule Error Adjustment",
    "Shift swap/offer", "Suggestions/Feedback", "Unpaid time off/vacation", "Testing"
  ];
  allTypes.forEach(type => {
    const id = type.replace(/[\s\/(),?'-]/g, '') + "Fields";
    const section = document.getElementById(id);
    if (section) section.style.display = (type === selected) ? "block" : "none";
  });
}

/* Accommodation CP3 toggle */
function toggleAccommodationCP3(show) {
  const el = document.getElementById("cp3Upload");
  if (el) el.style.display = show ? "block" : "none";
}

/* Additional hours mode toggle */
function toggleAdditionalHoursMode(multi) {
  const single = document.getElementById("singleDayFields");
  const multiEl = document.getElementById("multiDayFields");
  if (single && multiEl) {
    single.style.display = multi ? "none" : "block";
    multiEl.style.display = multi ? "block" : "none";
  }
}

/* Return to work toggle for Employee Status */
function toggleReturnToWork() {
  const status = document.querySelector('input[name="status_update_type"]:checked');
  const returnField = document.getElementById("returnToWorkContainer");
  if (returnField) {
    returnField.style.display = (status && status.value === "Inactive") ? "block" : "none";
  }
}

/* CP skill language show/hide */
function toggleCPSkillLanguage() {
  const lang = document.getElementById("cp_language").value;
  if (document.getElementById("orig_remove_en")) document.getElementById("orig_remove_en").style.display = (lang === "English") ? "block" : "none";
  if (document.getElementById("orig_add_en")) document.getElementById("orig_add_en").style.display = (lang === "English") ? "block" : "none";
  if (document.getElementById("orig_remove_fr")) document.getElementById("orig_remove_fr").style.display = (lang === "French") ? "block" : "none";
  if (document.getElementById("orig_add_fr")) document.getElementById("orig_add_fr").style.display = (lang === "French") ? "block" : "none";
  if (document.getElementById("orig_remove_bi")) document.getElementById("orig_remove_bi").style.display = (lang === "Bilingual") ? "block" : "none";
  if (document.getElementById("orig_add_bi")) document.getElementById("orig_add_bi").style.display = (lang === "Bilingual") ? "block" : "none";
}

/* Initialize page load state */
document.addEventListener("DOMContentLoaded", function() {
  ["orig_remove_en","orig_add_en","orig_remove_fr","orig_add_fr","orig_remove_bi","orig_add_bi"].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = "none";
  });
  const rtw = document.getElementById("returnToWorkContainer");
  if (rtw) rtw.style.display = "none";

  // Initialize all date pickers
  flatpickr(".datePicker", { dateFormat: "Y-m-d" });
});

/* Form validation before submit */
function validateForm() {
  const req = document.getElementById("wfm_request").value;

  if (!req) { alert("Please select a request type."); return false; }

  // Team meeting validation
  if (req === "Add/remove/change team meeting") {
    const a = document.querySelector('input[name="team_meeting_action"]:checked');
    const d = document.querySelector('input[name="team_meeting_date"]');
    const s = document.querySelector('input[name="team_meeting_start"]');
    const e = document.querySelector('input[name="team_meeting_end"]');
    const n = document.querySelector('textarea[name="team_meeting_notes"]');
    if (!a || !d.value || !s.value || !e.value) { alert("Complete all fields for team meeting."); return false; }
    if (!n.value.trim()) { alert("Please provide notes for the team meeting."); return false; }
  }

  // Training validation
  if (req === "Add/remove/move training") {
    const a = document.querySelector('input[name="training_action"]:checked');
    const d = document.querySelector('input[name="training_date"]');
    const s = document.querySelector('input[name="training_start"]');
    const e = document.querySelector('input[name="training_end"]');
    const n = document.querySelector('textarea[name="training_notes"]');
    if (!a || !d.value || !s.value || !e.value) { alert("Complete all fields for training request."); return false; }
    if (!n.value.trim()) { alert("Provide notes for the training request."); return false; }
  }

  // Late arrival validation
  if (req === "Advisor arrived late, remove absence") {
    const s = document.querySelector('input[name="actual_start_time"]');
    const a = document.querySelector('input[name="actual_arrival_time"]');
    const n = document.querySelector('textarea[name="late_arrival_notes"]');
    if (!s.value || !a.value) { alert("Fill both Actual Start and Arrival times."); return false; }
    if (!n.value.trim()) { alert("Provide notes for late arrival."); return false; }
  }

  // CP skill update validation
  if (req === "CP skill update") {
    const action = document.getElementById("cp_action");
    const lang = document.getElementById("cp_language");
    const notes = document.querySelector('textarea[name="cp_skill_notes"]');
    if (!action || !lang || !action.value || !lang.value) { alert("Select CP skill action and language."); return false; }

    if (lang.value === "English") {
      if (action.value === "Add") { if (!document.querySelector('select[name="skill_add_en"]').value) { alert("Select English skill to add."); return false; } }
      else { if (!document.querySelector('select[name="skill_remove_en"]').value) { alert("Select English skill to remove."); return false; } }
    } else if (lang.value === "French") {
      if (action.value === "Add") { if (!document.querySelector('select[name="skill_add_fr"]').value) { alert("Select French skill to add."); return false; } }
      else { if (!document.querySelector('select[name="skill_remove_fr"]').value) { alert("Select French skill to remove."); return false; } }
    } else if (lang.value === "Bilingual") {
      if (action.value === "Add") { if (!document.querySelector('select[name="skill_add_bi"]').value) { alert("Select Bilingual skill to add."); return false; } }
      else { if (!document.querySelector('select[name="skill_remove_bi"]').value) { alert("Select Bilingual skill to remove."); return false; } }
    }

    if (!notes.value.trim()) { alert("Provide notes for CP skill update."); return false; }
  }

  // Employee status update validation
  if (req === "Employee status update (not for schedule changes)") {
    const emp = document.querySelector('input[name="status_update_employee"]');
    const type = document.querySelector('input[name="status_update_type"]:checked');
    const eff = document.querySelector('input[name="status_update_effective_date"]');
    const ret = document.querySelector('input[name="status_update_return_date"]');
    const notes = document.querySelector('textarea[name="status_update_notes"]');
    if (!emp.value || !type || !eff.value) { alert("Complete all required fields for status update."); return false; }
    if (type.value === "Inactive" && !ret.value) { alert("Provide Return to Work date."); return false; }
    if (!notes.value.trim()) { alert("Provide notes or reason for status update."); return false; }
  }

  // Add any other request type validations here if needed

  return true;
}
</script>
</body>
</html>
