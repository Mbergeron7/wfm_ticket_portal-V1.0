<!DOCTYPE html> 
<html>
<head>
  <title>WFM Request Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      padding: 40px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .user-banner {
      text-align: center;
      margin-bottom: 20px;
      font-size: 14px;
      color: #555;
    }
    .logout-button {
      display: block;
      margin: 0 auto 30px auto;
      padding: 8px 16px;
      background-color: #ccc;
      color: #333;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      width: fit-content;
    }
    form {
      max-width: 700px;
      margin: 0 auto;
      background-color: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 20px;
      font-weight: bold;
      color: #444;
    }
    input[type="text"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      font-size: 14px;
    }
    input[type="file"] {
      margin-top: 10px;
    }
    textarea {
      resize: vertical;
      height: 100px;
    }
    button {
      margin-top: 30px;
      padding: 12px 20px;
      background-color: #0078D4;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #005fa3;
    }
  </style>
</head>
<body>
  <h1>Submit WFM Request</h1>

  {% if session.user_email %}
    <div class="user-banner">
      Logged in as <strong>{{ session.user_email }}</strong>
    </div>
    <a href="/logout" class="logout-button">Logout</a>
  {% endif %}

  <form method="POST" enctype="multipart/form-data" onsubmit="return validateForm()">
    <label>Advisor Name:</label>
    <input type="text" name="advisor_name" required>

    <label>Date of Request:</label>
    <input type="date" name="request_date" required>

    <label>Line of Business (LoB):</label>
    <select name="lob" required>
      <option value="" disabled selected>Select LoB</option>
      <option value="ERO">ERO</option>
      <option value="IT">IT</option>
      <option value="MoveBuddy">MoveBuddy</option>
      <option value="PS Admin">PS Admin</option>
      <option value="PS BO">PS BO</option>
      <option value="PS Case Mgr">PS Case Mgr</option>
      <option value="PS CC">PS CC</option>
      <option value="PS Onboarding">PS Onboarding</option>
      <option value="PS Sales">PS Sales</option>
      <option value="QA">QA</option>
      <option value="SS Case Management">SS Case Management</option>
      <option value="SS Onboarding">SS Onboarding</option>
      <option value="SS Sales">SS Sales</option>
      <option value="TL/LoD">TL/LoD</option>
      <option value="Training">Training</option>
      <option value="WL PS">WL PS</option>
      <option value="WL SS">WL SS</option>
      <option value="Workforce Management">Workforce Management</option>
    </select>

    <label>Team Lead:</label>
    <select name="team_lead" required>
      <option value="" disabled selected>Select Team Lead</option>
      <option value="Adeyinka">Adeyinka</option>
      <option value="Alana">Alana</option>
      <option value="Alexandra">Alexandra</option>
      <option value="Aman">Aman</option>
      <option value="Bryan">Bryan</option>
      <option value="Cushana">Cushana</option>
      <option value="David">David</option>
      <option value="Dee">Dee</option>
      <option value="Jodi">Jodi</option>
      <option value="Julianne">Julianne</option>
      <option value="Kristin">Kristin</option>
      <option value="Lucas">Lucas</option>
      <option value="Maggie">Maggie</option>
      <option value="Mike">Mike</option>
      <option value="Odette">Odette</option>
      <option value="Pat">Pat</option>
      <option value="Salomon">Salomon</option>
      <option value="Sean">Sean</option>
      <option value="Shavindri">Shavindri</option>
      <option value="Teresa">Teresa</option>
    </select>

    <label>WFM Request Type:</label>
    <select name="wfm_request" id="wfm_request" onchange="toggleRequestFields()" required>
      <option value="" disabled selected>Select Request Type</option>
      <option value="Accommodation request/update">Accommodation request/update</option>
      <option value="Add additional hours">Add additional hours</option>
      <option value="Add/remove/change team meeting">Add/remove/change team meeting</option>
      <option value="Add/remove/move training">Add/remove/move training</option>
      <option value="Add offline segment">Add offline segment</option>
      <option value="Advisor arrived late, remove absence">Advisor arrived late, remove absence</option>
      <option value="CP skill update">CP skill update</option>
      <option value="Employee status update (not for schedule changes)">Employee status update (not for schedule changes)</option>
      <option value="Is OT available?">Is OT available?</option>
      <option value="Move break/lunch because of meeting">Move break/lunch because of meeting</option>
      <option value="Schedule Update - CP3 use">Schedule Update - CP3 use</option>
      <option value="Schedule Error Adjustment">Schedule Error Adjustment</option>
      <option value="Shift swap/offer">Shift swap/offer</option>
      <option value="Suggestions/Feedback">Suggestions/Feedback</option>
      <option value="Unpaid time off/vacation">Unpaid time off/vacation</option>
      <option value="Testing">Testing</option>
    </select>

<!-- Accommodation Section -->
<div id="AccommodationrequestupdateFields" style="display:none;">
  ...
</div>

<!-- Add Additional Hours Section -->
<div id="AddadditionalhoursFields" style="display:none;">
  ...
</div>

<!-- Add/Remove/Change Team Meeting Section -->
<div id="AddremovechangeteammeetingFields" style="display:none;">
  ...
</div>

<!-- Add/Remove/Move Training Section -->
<div id="AddremovemovetrainingFields" style="display:none;">
  ...
</div>

<!-- Add Offline Segment Section -->
<div id="AddofflinesegmentFields" style="display:none;">
  ...
</div>

<!-- Advisor Arrived Late Section -->
<div id="AdvisorarrivedlateremoveabsenceFields" style="display:none;">
  ...
</div>

<!-- CP Skill Update -->
<div id="CPskillupdateFields" style="display:none;">
  ...
</div>

    <!-- CP Skill Update -->
<div id="CPskillupdateFields" style="display:none;">
  <label>Skill Update Type:</label>
  <select name="cp_skill_action" required>
    <option value="" disabled selected>Select Action</option>
    <option value="Add">Add</option>
    <option value="Remove">Remove</option>
  </select>

  <label>Language:</label>
  <select name="cp_skill_language" required>
    <option value="" disabled selected>Select Language</option>
    <option value="English">English</option>
    <option value="French">French</option>
  </select>

  <label>Skill(s):</label>
  <select name="cp_skill_selection" required>
    <option value="" disabled selected>Select Skill</option>
    <option>MoveBuddy</option>
    <option>PS CC EN</option>
    <option>PS Sales EN</option>
    <option>PS WL EN</option>
    <option>SS CM EN</option>
    <option>SS Sales EN</option>
    <option>SS WL EN</option>
    <option>PS CC FR</option>
    <option>PS Sales FR</option>
    <option>PS WL FR</option>
    <option>SS CM FR</option>
    <option>SS Sales FR</option>
    <option>SS WL FR</option>
    <option>PS Test</option>
    <option>SS Test</option>
  </select>

  <label>Notes or Reason:</label>
  <textarea name="cp_skill_notes" placeholder="Explain reason for this skill update."></textarea>
</div>

<!-- Employee Status Update (Not for Schedule Changes) -->
<div id="EmployeestatusupdatenotforschedulechangesFields" style="display:none;">
  <label>Employee Name or ID:</label>
  <input type="text" name="status_update_employee" placeholder="Enter full name or ID" required>

  <label>Status Change:</label>
  <div style="margin-top: 8px;">
    <input type="radio" name="status_update_type" value="Active" onclick="toggleReturnToWork()" required> Active
    <input type="radio" name="status_update_type" value="Inactive" onclick="toggleReturnToWork()"> Inactive
    <input type="radio" name="status_update_type" value="Update" onclick="toggleReturnToWork()"> Update
  </div>

  <label style="margin-top: 20px;">Effective Date of Status Change:</label>
  <input type="date" name="status_update_effective_date" required>

  <div id="returnToWorkContainer" style="display:none;">
    <label>Return to Work Date:</label>
    <input type="date" name="status_update_return_date">
  </div>

  <label>Notes or Reason:</label>
  <textarea name="status_update_notes" placeholder="Explain the context or reason for this status change." required></textarea>
</div>

<!-- Submit Button -->
<button type="submit">Submit</button>
</form>

  <script>
function toggleRequestFields() {
  const selected = document.getElementById("wfm_request").value;
  const allTypes = [
    "Accommodation request/update", "Add additional hours", "Add/remove/change team meeting",
    "Add/remove/move training", "Add offline segment", "Advisor arrived late, remove absence",
    "CP skill update", "Employee status update (not for schedule changes)", "Is OT available?",
    "Move break/lunch because of meeting", "Schedule Update - CP3 use", "Schedule Error Adjustment",
    "Shift swap/offer", "Suggestions/Feedback", "Unpaid time off/vacation", "Testing"
  ];
  allTypes.forEach(type => {
    const id = type.replace(/[\s\/(),]/g, '') + "Fields";
    const section = document.getElementById(id);
    if (section) section.style.display = (type === selected) ? "block" : "none";
  });
}

function toggleAccommodationCP3(show) {
  const el = document.getElementById("cp3Upload");
  if (el) el.style.display = show ? "block" : "none";
}

function toggleAdditionalHoursMode(multi) {
  document.getElementById("singleDayFields").style.display = multi ? "none" : "block";
  document.getElementById("multiDayFields").style.display = multi ? "block" : "none";
}

function toggleReturnToWork() {
  const status = document.querySelector('input[name="status_update_type"]:checked');
  const returnField = document.getElementById("returnToWorkContainer");
  if (returnField) {
    returnField.style.display = (status && status.value === "Inactive") ? "block" : "none";
  }
}

function validateForm() {
  const req = document.getElementById("wfm_request").value;

  if (req === "Add/remove/change team meeting") {
    const a = document.querySelector('input[name="team_meeting_action"]:checked');
    const d = document.querySelector('input[name="team_meeting_date"]');
    const s = document.querySelector('input[name="team_meeting_start"]');
    const e = document.querySelector('input[name="team_meeting_end"]');
    const n = document.querySelector('textarea[name="team_meeting_notes"]');
    if (!a || !d.value || !s.value || !e.value) {
      alert("Please complete all required fields for the team meeting.");
      return false;
    }
    if (!n.value.trim()) {
      alert("Please provide notes or a reason for the team meeting request.");
      return false;
    }
  }

  if (req === "Add/remove/move training") {
    const a = document.querySelector('input[name="training_action"]:checked');
    const d = document.querySelector('input[name="training_date"]');
    const s = document.querySelector('input[name="training_start"]');
    const e = document.querySelector('input[name="training_end"]');
    const n = document.querySelector('textarea[name="training_notes"]');
    if (!a || !d.value || !s.value || !e.value) {
      alert("Please complete all required fields for the training request.");
      return false;
    }
    if (!n.value.trim()) {
      alert("Please provide notes or a reason for the training request.");
      return false;
    }
  }

  if (req === "Advisor arrived late, remove absence") {
    const s = document.querySelector('input[name="actual_start_time"]');
    const a = document.querySelector('input[name="actual_arrival_time"]');
    const n = document.querySelector('textarea[name="late_arrival_notes"]');
    if (!s.value || !a.value) {
      alert("Please fill both Actual Start and Arrival times.");
      return false;
    }
    if (!n.value.trim()) {
      alert("Please provide notes for the late arrival.");
      return false;
    }
  }

  if (req === "CP skill update") {
    const action = document.querySelector('select[name="cp_skill_action"]');
    const lang = document.querySelector('select[name="cp_skill_language"]');
    const skill = document.querySelector('select[name="cp_skill_selection"]');
    const n = document.querySelector('textarea[name="cp_skill_notes"]');
    if (!action.value || !lang.value || !skill.value || !n.value.trim()) {
      alert("Please complete all required fields for the CP Skill Update.");
      return false;
    }
  }

  if (req === "Employee status update (not for schedule changes)") {
    const emp = document.querySelector('input[name="status_update_employee"]');
    const type = document.querySelector('input[name="status_update_type"]:checked');
    const eff = document.querySelector('input[name="status_update_effective_date"]');
    const ret = document.querySelector('input[name="status_update_return_date"]');
    const notes = document.querySelector('textarea[name="status_update_notes"]');
    if (!emp.value || !type || !eff.value) {
      alert("Please complete all required fields for the status update.");
      return false;
    }
    if (type.value === "Inactive" && !ret.value) {
      alert("Please provide a Return to Work date for inactive status.");
      return false;
    }
    if (!notes.value.trim()) {
      alert("Please provide notes or a reason for the status update.");
      return false;
    }
  }

  return true;
}
</script>
</body>
</html>
